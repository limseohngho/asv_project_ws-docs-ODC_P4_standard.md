#!/bin/bash

# [ODC-P4] Coding Standard: Build Script
# Purpose: ROS 2 ì›Œí¬ìŠ¤íŽ˜ì´ìŠ¤ í†µí•© ë¹Œë“œ ë° ë¡œê·¸ ìžë™í™”

# 1. í•„ìˆ˜ ë””ë ‰í† ë¦¬ ìƒì„± (logs/ í´ë”ê°€ ì—†ì„ ê²½ìš° ìžë™ ìƒì„±)
mkdir -p logs

# 2. ë¡œê·¸ íŒŒì¼ëª… ê·œì¹™ ì¤€ìˆ˜ (build_yyyymmdd_hhmmss.log)
# date ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ íƒ€ìž„ìŠ¤íƒ¬í”„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
LOG_FILE="logs/build_${TIMESTAMP}.log"

echo "-----------------------------------------------"
echo "ðŸš€ ASV Project Build ì‹œìž‘"
echo "ðŸ“‚ ë¡œê·¸ íŒŒì¼: ${LOG_FILE}"
echo "-----------------------------------------------"

# 3. ROS í™˜ê²½ ì„¤ì • (Ubuntu 22.04 / ROS 2 Humble ê¸°ì¤€)
# ì´ë¯¸ í™˜ê²½ì´ ë¡œë“œë˜ì–´ ìžˆì„ ìˆ˜ ìžˆì§€ë§Œ, ìž¬í˜„ì„±ì„ ìœ„í•´ ëª…ì‹œì ìœ¼ë¡œ ë¡œë“œí•©ë‹ˆë‹¤.
if [ -f "/opt/ros/humble/setup.bash" ]; then
    source /opt/ros/humble/setup.bash
fi

# 4. colcon build ìˆ˜í–‰
# --symlink-install: íŒŒì´ì¬ ì†ŒìŠ¤ ìˆ˜ì • ì‹œ ë‹¤ì‹œ ë¹Œë“œí•˜ì§€ ì•Šì•„ë„ ë°˜ì˜ë¨ (íš¨ìœ¨ì )
# 2>&1 | tee: ë¹Œë“œ í™”ë©´ ì¶œë ¥ì„ í„°ë¯¸ë„ì— ë³´ì—¬ì¤Œê³¼ ë™ì‹œì— ë¡œê·¸ íŒŒì¼ë¡œ ì €ìž¥
colcon build --symlink-install 2>&1 | tee ${LOG_FILE}

echo "-----------------------------------------------"
echo "âœ… ë¹Œë“œ ì™„ë£Œ (Log: ${LOG_FILE})"
echo "-----------------------------------------------"
